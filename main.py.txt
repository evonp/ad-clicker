import time
import os
from time_scheduler import should_run_click, get_click_delay
from click_executor import execute_click
from proxy_manager import setup_warp_proxy

# å®‰è£…WARPä»£ç†
if not os.environ.get("WARP_INSTALLED"):
    try:
        setup_warp_proxy()
        os.environ["WARP_INSTALLED"] = "true"
    except Exception as e:
        print(f"âš ï¸ Critical error in proxy setup: {e}")
        # ç»§ç»­è¿è¡Œä½†å¯èƒ½å½±å“æ•ˆæœ

def main():
    print("ğŸŸ¢ Ad Click System Started")
    click_count = 0
    
    while True:
        if should_run_click():
            print("â° Time to run a click")
            success = execute_click()
            if success:
                click_count += 1
                print(f"ğŸ“Š Total Clicks: {click_count}")
            else:
                print("ğŸ”„ Attempting next click later")
        
        # è®¡ç®—ä¸‹æ¬¡è¿è¡Œæ—¶é—´
        delay = get_click_delay()
        print(f"â³ Next check in {delay//60} minutes")
        time.sleep(delay)

if __name__ == "__main__":
    main()